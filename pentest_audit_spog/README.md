# External Asset Mapper - Automated Mapping of External IPs to Applications

## üìå Overview
External Asset Mapper is an automated tool designed to **map externally exposed IPs to their respective applications** using multiple data sources. It cross-validates results from automated scanning and commercial security tools (e.g., Qualys) to provide a **comprehensive view** of your external attack surface.

## üöÄ Features

### **1Ô∏è‚É£ Starting Point: CIDR Ranges or Qualys Scan Data**
- Accepts **CIDR ranges** and expands them to individual IPs.
- Parses **Qualys scan reports** to extract external IPs.
- **Cross-validates findings** between internal and external scans to identify discrepancies.

### **2Ô∏è‚É£ SSL Certificate Extraction**
- Scrapes **public Certificate Transparency logs** (crt.sh, Censys, Google CT logs).
- Probes external-facing assets using **OpenSSL & Nmap SSL scripts**.
- Pulls **certificate data from Qualys reports** (if available).

### **3Ô∏è‚É£ Domain to Application Mapping**
- Uses **internal documentation and API pulls** (e.g., CSI application mappings).
- Cross-references domain names **found in certificates** with known applications.

### **4Ô∏è‚É£ IP to Domain Mapping**
- Uses **Reverse DNS lookups** to identify domain names linked to externally exposed IPs.
- Queries **passive DNS databases** (Censys, PassiveTotal, RiskIQ, VirusTotal, etc.) to enrich mapping data.

### **5Ô∏è‚É£ Validation & Correlation**
- **Cross-checks findings from CIDR expansion and Qualys scans**, flagging discrepancies.
- Correlates **multiple data sources** to ensure accuracy.
- Generates **Delta Reports** to highlight missing or misconfigured mappings.
- Flags **high-risk deltas** and integrates them into **ASM/ASR workflows**.

### **6Ô∏è‚É£ VIP (Virtual IP) Handling & Multi-Tenant Identification**
- Detects **VIPs with multiple hosts behind them** by:
  - Parsing **Qualys reports for VIP metadata**.
  - Performing **active load balancer checks** (HTTP headers, round-robin detection, passive fingerprinting).
  - **Correlating multiple sources** (DNS, SSL SANs, server banners) for response variations.
- **Multi-Tenant VIP Detection:**
  - Runs **repeated HTTP(S) requests** to detect **rotating hostnames behind VIPs**.
  - Analyzes **SSL certificate SANs** to detect multiple services on the same VIP.
  - Captures **HTTP response headers & content variations**.
  - Uses **TLS fingerprinting (versions, ciphers, banners, etc.)** to detect service uniqueness.
- Generates **relationship mappings** between VIPs and backend hosts.
- Flags **multi-tenant VIPs**, ensuring security teams are aware of shared infrastructure risks.

### **7Ô∏è‚É£ Visualizing VIP-Host Mappings**
- **JSON Graph Format:**
  - Structured JSON output shows VIPs, backend hosts, and application relationships.
- **GraphViz / NetworkX Diagrams:**
  - Generates **interactive network graphs** to visualize **multi-tenant VIP structures**.
- **HTML Reports with Sankey Diagrams:**
  - Provides a **visual representation of VIP traffic flow** to backend hosts.
  - Helps security teams **understand external-to-internal asset mappings**.

### **8Ô∏è‚É£ Output & Reporting**
- Generates **structured JSON & CSV reports**.
- Sends **alerts for unknown IPs/domains** without mappings.
- Produces **Delta Reports** to highlight discrepancies.
- Flags high-risk **ASM/ASR workflow items**.
- **Graph-based VIP relationship mapping** for better visualization.
- Future-ready for **API integration**.

### **9Ô∏è‚É£ CLI Support for Dynamic Input & Error Handling**
- Accepts **CIDR ranges or Qualys scan files** as input.
- **Validates input format** to reject malformed CIDRs or improperly structured Qualys scans.
- Handles **missing/unexpected data gracefully**, logging errors without stopping execution.

---

## üõ†Ô∏è Installation & Setup
### **Prerequisites**
- Python 3.8+
- Recommended: Install in a virtual environment

### **Installation**
```sh
# Clone the repository
git clone https://github.com/yourrepo/external-asset-mapper.git
cd external-asset-mapper

# Install dependencies
pip install -r requirements.txt
```

---

## üîß Usage
### **Basic Command-Line Usage**
#### **1Ô∏è‚É£ Run Against a Qualys Scan File**
```sh
python external_asset_mapper.py --input path/to/qualys_scan.csv
```
#### **2Ô∏è‚É£ Run Against a CIDR Range**
```sh
python external_asset_mapper.py --input 192.168.1.0/24
```
#### **3Ô∏è‚É£ Compare Internal and External Scans**
```sh
python external_asset_mapper.py --input internal_qualys_scan.csv
python external_asset_mapper.py --input external_scan_cidr.txt
```

---

## üìú Output Formats
### **1Ô∏è‚É£ JSON Report** (Structured for API ingestion & historical tracking)
```json
{
  "datacenter": "DC-1",
  "timestamp": "2025-03-01T12:00:00Z",
  "mappings": [
    {
      "external_ip": "198.51.100.10",
      "type": "VIP",
      "mapped_hosts": [
        {
          "internal_ip": "10.1.1.5",
          "hostname": "app-server-01.internal.net",
          "last_seen": "2025-02-28T14:30:00Z"
        },
        {
          "internal_ip": "10.1.1.6",
          "hostname": "app-server-02.internal.net",
          "last_seen": "2025-02-28T14:30:00Z"
        }
      ]
    }
  ]
}
```
### **2Ô∏è‚É£ CSV Report** (For security & remediation teams)
| External IP | Type | Internal IP | Hostname | Last Seen | Source | Status |
|------------|------|-------------|-----------|-------------|------------|--------|
| 198.51.100.10 | VIP | 10.1.1.5 | app-server-01.internal.net | 2025-02-28 14:30 | Scanner | Confirmed |
| 198.51.100.10 | VIP | 10.1.1.6 | app-server-02.internal.net | 2025-02-28 14:30 | Scanner | Confirmed |
| 203.0.113.20 | NAT | 10.2.2.10 | db-server.internal.net | 2025-02-27 18:45 | Scanner | Mismatch |

---

## ‚ö†Ô∏è Limitations & Future Improvements
‚úî **Enhance inventory integrations** (CMDB, ServiceNow, ASM tools).  
‚úî **Improve delta tracking** to highlight changes over time.  
‚úî **Expand API support** for seamless automation.  
‚úî **Add ML-based anomaly detection** for dynamic security insights.  

---

## üì¨ Support & Contributions
- **Contributions are welcome!** Feel free to submit PRs or open issues.
- Contact: TBD in the team 

---

### **üî• This is now an enterprise-grade external asset mapping tool! üöÄ**